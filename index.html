<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lesson Tracker</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.28/jspdf.plugin.autotable.min.js"></script>
    <style>
        :root {
            --primary: #3498db;
            --secondary: #2ecc71;
            --accent: #e74c3c;
            --warning: #f39c12;
            --light: #f8f9fa;
            --dark: #2c3e50;
            --gray: #7f8c8d;
            --border: #ddd;
            --card-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #f5f7fa 0%, #e4e8f0 100%);
            color: var(--dark);
            line-height: 1.6;
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 12px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }
        
        header {
            background: linear-gradient(120deg, var(--primary) 0%, #2980b9 100%);
            color: white;
            padding: 25px;
            text-align: center;
            position: relative;
        }
        
        .offline-badge {
            position: absolute;
            top: 15px;
            right: 15px;
            background: rgba(255, 255, 255, 0.2);
            padding: 5px 10px;
            border-radius: 20px;
            font-size: 12px;
            display: flex;
            align-items: center;
        }
        
        .offline-badge i {
            margin-right: 5px;
        }
        
        .logo {
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 15px;
        }
        
        .logo i {
            font-size: 32px;
            margin-right: 15px;
            background: white;
            color: var(--primary);
            width: 50px;
            height: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
        }
        
        h1 {
            font-size: 28px;
            margin-bottom: 10px;
        }
        
        .subtitle {
            font-size: 16px;
            opacity: 0.9;
        }
        
        .storage-info {
            background: rgba(255, 255, 255, 0.1);
            padding: 10px;
            border-radius: 8px;
            margin-top: 15px;
            font-size: 14px;
        }
        
        .content-area {
            padding: 25px;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 25px;
        }
        
        .stat-card {
            background: white;
            padding: 15px;
            border-radius: 8px;
            box-shadow: var(--card-shadow);
            text-align: center;
            border-left: 4px solid var(--primary);
        }
        
        .stat-card.warning {
            border-left-color: var(--warning);
        }
        
        .stat-card.accent {
            border-left-color: var(--accent);
        }
        
        .stat-card.secondary {
            border-left-color: var(--secondary);
        }
        
        .stat-value {
            font-size: 24px;
            font-weight: bold;
            margin: 10px 0;
        }
        
        .stat-label {
            font-size: 14px;
            color: var(--gray);
        }
        
        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .form-group {
            margin-bottom: 15px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--dark);
        }
        
        .form-control {
            width: 100%;
            padding: 12px 15px;
            border: 1px solid var(--border);
            border-radius: 6px;
            font-size: 16px;
            transition: all 0.3s ease;
        }
        
        .form-control:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.2);
        }
        
        .btn {
            padding: 12px 20px;
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            margin-right: 10px;
            margin-bottom: 10px;
        }
        
        .btn i {
            margin-right: 8px;
        }
        
        .btn:hover {
            opacity: 0.9;
            transform: translateY(-2px);
        }
        
        .btn-primary {
            background: var(--primary);
        }
        
        .btn-secondary {
            background: var(--secondary);
        }
        
        .btn-accent {
            background: var(--accent);
        }
        
        .btn-warning {
            background: var(--warning);
        }
        
        .btn-pdf {
            background: #e74c3c;
        }
        
        .btn-json {
            background: #9b59b6;
        }
        
        .form-actions {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            margin-bottom: 20px;
        }
        
        .data-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 30px;
            background: white;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: var(--card-shadow);
        }
        
        .data-table th, .data-table td {
            padding: 16px 20px;
            text-align: left;
            border-bottom: 1px solid var(--border);
        }
        
        .data-table th {
            background-color: var(--primary);
            color: white;
            font-weight: 600;
        }
        
        .data-table tr:last-child td {
            border-bottom: none;
        }
        
        .data-table tr:hover {
            background-color: #f5f7fa;
        }
        
        .action-buttons {
            display: flex;
            gap: 8px;
        }
        
        .action-btn {
            padding: 6px 10px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            display: inline-flex;
            align-items: center;
        }
        
        .edit-btn {
            background: var(--warning);
            color: white;
        }
        
        .delete-btn {
            background: var(--accent);
            color: white;
        }
        
        .footer {
            text-align: center;
            margin-top: 30px;
            color: var(--gray);
            font-size: 14px;
            padding: 20px;
            border-top: 1px solid var(--border);
        }
        
        .save-indicator {
            position: fixed;
            bottom: 20px;
            right: 20px;
            padding: 12px 18px;
            background-color: var(--secondary);
            color: white;
            border-radius: 6px;
            font-weight: 500;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
            opacity: 0;
            transition: opacity 0.3s ease;
            display: flex;
            align-items: center;
            z-index: 1000;
        }
        
        .save-indicator i {
            margin-right: 8px;
        }
        
        .save-indicator.show {
            opacity: 1;
        }
        
        .filter-controls {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
            flex-wrap: wrap;
            align-items: center;
        }
        
        .filter-controls select, .filter-controls input {
            padding: 10px 15px;
            border: 1px solid var(--border);
            border-radius: 6px;
            font-size: 16px;
        }
        
        .storage-status {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            margin-top: 20px;
            border-left: 4px solid var(--primary);
        }
        
        .import-export {
            margin-top: 20px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 8px;
            border-left: 4px solid #9b59b6;
        }
        
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 2000;
            align-items: center;
            justify-content: center;
        }
        
        .modal-content {
            background: white;
            padding: 25px;
            border-radius: 10px;
            width: 90%;
            max-width: 500px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        
        .modal-close {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: var(--gray);
        }
        
        .confirmation-modal .btn {
            margin-top: 20px;
        }
        
        /* Print styles */
        @media print {
            body {
                background: white;
                padding: 0;
            }
            
            .container {
                box-shadow: none;
                border-radius: 0;
            }
            
            header {
                background: white !important;
                color: black !important;
                padding: 20px;
                border-bottom: 2px solid var(--primary);
            }
            
            .offline-badge, .stats-grid, .form-grid, .form-actions, .footer, 
            .filter-controls, .storage-status, .import-export, .action-buttons {
                display: none !important;
            }
            
            .content-area {
                padding: 15px;
            }
            
            .data-table {
                box-shadow: none;
                page-break-inside: avoid;
            }
            
            .data-table th {
                background-color: white !important;
                color: black !important;
                border-bottom: 2px solid black;
            }
            
            .print-header {
                text-align: center;
                margin-bottom: 20px;
            }
            
            .print-title {
                font-size: 24px;
                margin-bottom: 10px;
                color: var(--dark);
            }
            
            .print-subtitle {
                font-size: 16px;
                color: var(--gray);
                margin-bottom: 20px;
            }
        }
        
        @media (max-width: 768px) {
            .form-grid {
                grid-template-columns: 1fr;
            }
            
            .stats-grid {
                grid-template-columns: 1fr 1fr;
            }
            
            .form-actions, .filter-controls {
                flex-direction: column;
                align-items: stretch;
            }
            
            .btn {
                width: 100%;
                margin-right: 0;
            }
            
            .data-table {
                display: block;
                overflow-x: auto;
            }
            
            .offline-badge {
                position: relative;
                top: 0;
                right: 0;
                margin: 10px auto;
                width: fit-content;
            }
            
            .action-buttons {
                flex-direction: column;
                gap: 5px;
            }
            
            .action-btn {
                width: 100%;
                justify-content: center;
            }
        }
        
        @media (max-width: 480px) {
            .stats-grid {
                grid-template-columns: 1fr;
            }
            
            header {
                padding: 15px;
            }
            
            .logo {
                flex-direction: column;
                text-align: center;
            }
            
            .logo i {
                margin-right: 0;
                margin-bottom: 10px;
            }
        }
        
        .empty-state {
            text-align: center;
            padding: 40px 20px;
            color: var(--gray);
        }
        
        .empty-state i {
            font-size: 64px;
            margin-bottom: 15px;
            opacity: 0.5;
        }
        
        .status-badge {
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: 600;
        }
        
        .status-completed {
            background: #e8f5e9;
            color: #2e7d32;
        }
        
        .status-pending {
            background: #ffecb3;
            color: #f57c00;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <div class="offline-badge">
                <i class="fas fa-wifi-slash"></i> Works Offline
            </div>
            <div class="logo">
                <i class="fas fa-book-open"></i>
                <div>
                    <h1>Lesson Tracker</h1>
                    <p class="subtitle">All data stored locally in your browser - no internet needed</p>
                </div>
            </div>
            <div class="storage-info">
                <i class="fas fa-database"></i> All data is saved automatically to your browser's storage
            </div>
        </header>
        
        <div class="content-area">
            <div class="stats-grid" id="stats-container">
                <!-- Stats will be populated by JavaScript -->
            </div>
            
            <form id="lesson-form">
                <input type="hidden" id="edit-id" value="">
                
                <div class="form-grid">
                    <div class="form-group">
                        <label for="subject">Subject</label>
                        <select class="form-control" id="subject" required>
                            <option value="">Select a subject</option>
                            <option value="english">English</option>
                            <option value="math">Math</option>
                            <option value="science">Science</option>
                            <option value="filipino">Filipino</option>
                            <option value="ap">Araling Panlipunan</option>
                            <option value="epp">EPP</option>
                            <option value="gmrc">GMRC</option>
                            <option value="mapeh">MAPEH</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="week">Week</label>
                        <select class="form-control" id="week" required>
                            <option value="">Select a week</option>
                            <option value="1">Week 1</option>
                            <option value="2">Week 2</option>
                            <option value="3">Week 3</option>
                            <option value="4">Week 4</option>
                            <option value="5">Week 5</option>
                            <option value="6">Week 6</option>
                            <option value="7">Week 7</option>
                            <option value="8">Week 8</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="day">Day</label>
                        <select class="form-control" id="day" required>
                            <option value="">Select a day</option>
                            <option value="1">Day 1</option>
                            <option value="2">Day 2</option>
                            <option value="3">Day 3</option>
                            <option value="4">Day 4</option>
                            <option value="5">Day 5</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="status">Status</label>
                        <select class="form-control" id="status" required>
                            <option value="pending">Pending</option>
                            <option value="completed">Completed</option>
                        </select>
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="topic">Topic Name</label>
                    <input type="text" class="form-control" id="topic" placeholder="Enter topic name" required>
                </div>
                
                <div class="form-group">
                    <label for="notes">Notes (Optional)</label>
                    <textarea class="form-control" id="notes" placeholder="Add any additional notes" rows="3"></textarea>
                </div>
                
                <div class="form-actions">
                    <button type="submit" class="btn btn-primary" id="submit-btn">
                        <i class="fas fa-plus"></i> Add Lesson
                    </button>
                    <button type="button" class="btn btn-secondary" id="cancel-edit-btn" style="display: none;">
                        <i class="fas fa-times"></i> Cancel Edit
                    </button>
                    <button type="button" class="btn btn-secondary" id="print-btn">
                        <i class="fas fa-print"></i> Print Table
                    </button>
                    <button type="button" class="btn btn-pdf" id="pdf-btn">
                        <i class="fas fa-file-pdf"></i> Export as PDF
                    </button>
                    <button type="button" class="btn btn-json" id="export-json-btn">
                        <i class="fas fa-file-export"></i> Export JSON
                    </button>
                    <button type="button" class="btn btn-warning" id="import-json-btn">
                        <i class="fas fa-file-import"></i> Import JSON
                    </button>
                    <button type="button" class="btn btn-accent" id="reset-btn">
                        <i class="fas fa-trash"></i> Clear All
                    </button>
                </div>
            </form>
            
            <div class="filter-controls">
                <div>
                    <label for="filter-subject">Subject:</label>
                    <select id="filter-subject">
                        <option value="all">All Subjects</option>
                        <option value="english">English</option>
                        <option value="math">Math</option>
                        <option value="science">Science</option>
                        <option value="filipino">Filipino</option>
                        <option value="ap">Araling Panlipunan</option>
                        <option value="epp">EPP</option>
                        <option value="gmrc">GMRC</option>
                        <option value="mapeh">MAPEH</option>
                    </select>
                </div>
                
                <div>
                    <label for="filter-week">Week:</label>
                    <select id="filter-week">
                        <option value="all">All Weeks</option>
                        <option value="1">Week 1</option>
                        <option value="2">Week 2</option>
                        <option value="3">Week 3</option>
                        <option value="4">Week 4</option>
                        <option value="5">Week 5</option>
                        <option value="6">Week 6</option>
                        <option value="7">Week 7</option>
                        <option value="8">Week 8</option>
                    </select>
                </div>
                
                <div>
                    <label for="filter-status">Status:</label>
                    <select id="filter-status">
                        <option value="all">All Status</option>
                        <option value="pending">Pending</option>
                        <option value="completed">Completed</option>
                    </select>
                </div>
                
                <div>
                    <label for="search">Search:</label>
                    <input type="text" id="search" placeholder="Search topics...">
                </div>
                
                <button class="btn btn-primary" id="apply-filters">
                    <i class="fas fa-filter"></i> Apply Filters
                </button>
                
                <button class="btn btn-secondary" id="clear-filters">
                    <i class="fas fa-times"></i> Clear Filters
                </button>
            </div>
            
            <div class="print-header">
                <h2 class="print-title">Lesson Tracker</h2>
                <p class="print-subtitle">All subjects and their lesson progress</p>
            </div>
            
            <table class="data-table">
                <thead>
                    <tr>
                        <th>Subject</th>
                        <th>Week</th>
                        <th>Day</th>
                        <th>Topic Name</th>
                        <th>Status</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody id="lesson-data">
                    <!-- Data will be populated here -->
                </tbody>
            </table>
            
            <div class="storage-status">
                <h3><i class="fas fa-info-circle"></i> Local Storage Information</h3>
                <p>All your data is stored locally in your browser using localStorage. This means:</p>
                <ul>
                    <li>No internet connection is required to use this application</li>
                    <li>Your data remains private and is not sent to any server</li>
                    <li>Your data will persist even if you close the browser</li>
                    <li>To transfer data to another device, use the Export/Import features</li>
                </ul>
            </div>
            
            <div class="import-export">
                <h3><i class="fas fa-file-import"></i> Import/Export Data</h3>
                <p>You can export your data as a JSON file to backup or transfer to another device. You can also import previously exported data.</p>
                <input type="file" id="import-file" accept=".json" style="display: none;">
            </div>
        </div>
        
        <div class="footer">
            <p>Enhanced Lesson Tracker &copy; 2023 | All data stored locally in your browser - no internet required</p>
        </div>
        
        <div class="save-indicator" id="save-indicator">
            <i class="fas fa-check-circle"></i> Data Saved Locally
        </div>
        
        <!-- Confirmation Modal -->
        <div class="modal confirmation-modal" id="confirmation-modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h3>Confirm Action</h3>
                    <button class="modal-close">&times;</button>
                </div>
                <p id="confirmation-message">Are you sure you want to perform this action?</p>
                <div>
                    <button class="btn btn-accent" id="confirm-action">Confirm</button>
                    <button class="btn btn-secondary" id="cancel-action">Cancel</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Initialize jsPDF
        window.jsPDF = window.jspdf.jsPDF;
        
        document.addEventListener('DOMContentLoaded', function() {
            const lessonForm = document.getElementById('lesson-form');
            const lessonData = document.getElementById('lesson-data');
            const printBtn = document.getElementById('print-btn');
            const pdfBtn = document.getElementById('pdf-btn');
            const resetBtn = document.getElementById('reset-btn');
            const saveIndicator = document.getElementById('save-indicator');
            const filterSubject = document.getElementById('filter-subject');
            const filterWeek = document.getElementById('filter-week');
            const filterStatus = document.getElementById('filter-status');
            const searchInput = document.getElementById('search');
            const applyFilters = document.getElementById('apply-filters');
            const clearFilters = document.getElementById('clear-filters');
            const submitBtn = document.getElementById('submit-btn');
            const cancelEditBtn = document.getElementById('cancel-edit-btn');
            const editIdField = document.getElementById('edit-id');
            const exportJsonBtn = document.getElementById('export-json-btn');
            const importJsonBtn = document.getElementById('import-json-btn');
            const importFileInput = document.getElementById('import-file');
            const statsContainer = document.getElementById('stats-container');
            const confirmationModal = document.getElementById('confirmation-modal');
            const confirmActionBtn = document.getElementById('confirm-action');
            const cancelActionBtn = document.getElementById('cancel-action');
            const confirmationMessage = document.getElementById('confirmation-message');
            const modalCloseBtn = document.querySelector('.modal-close');
            
            let lessons = [];
            let currentFilters = {
                subject: 'all',
                week: 'all',
                status: 'all',
                search: ''
            };
            let pendingAction = null;
            
            // Load data from localStorage
            function loadData() {
                try {
                    const savedData = localStorage.getItem('lessonData');
                    if (savedData) {
                        lessons = JSON.parse(savedData);
                        renderTable();
                        updateStats();
                    } else {
                        showEmptyState();
                        updateStats();
                    }
                } catch (error) {
                    console.error('Error loading data:', error);
                    showError('Failed to load data from storage');
                    lessons = [];
                    showEmptyState();
                }
            }
            
            // Show empty state
            function showEmptyState() {
                lessonData.innerHTML = `
                    <tr>
                        <td colspan="6" class="empty-state">
                            <i class="fas fa-inbox"></i>
                            <h3>No lessons added yet</h3>
                            <p>Start by adding a lesson using the form above.</p>
                        </td>
                    </tr>
                `;
            }
            
            // Update statistics
            function updateStats() {
                const totalLessons = lessons.length;
                const completedLessons = lessons.filter(lesson => lesson.status === 'completed').length;
                const pendingLessons = totalLessons - completedLessons;
                const completionRate = totalLessons > 0 ? Math.round((completedLessons / totalLessons) * 100) : 0;
                
                statsContainer.innerHTML = `
                    <div class="stat-card">
                        <div class="stat-label">Total Lessons</div>
                        <div class="stat-value">${totalLessons}</div>
                    </div>
                    <div class="stat-card secondary">
                        <div class="stat-label">Completed</div>
                        <div class="stat-value">${completedLessons}</div>
                    </div>
                    <div class="stat-card warning">
                        <div class="stat-label">Pending</div>
                        <div class="stat-value">${pendingLessons}</div>
                    </div>
                    <div class="stat-card accent">
                        <div class="stat-label">Completion Rate</div>
                        <div class="stat-value">${completionRate}%</div>
                    </div>
                `;
            }
            
            // Save data to localStorage
            function saveData() {
                try {
                    localStorage.setItem('lessonData', JSON.stringify(lessons));
                    
                    // Show save indicator
                    saveIndicator.classList.add('show');
                    setTimeout(() => {
                        saveIndicator.classList.remove('show');
                    }, 2000);
                    
                    updateStats();
                } catch (error) {
                    console.error('Error saving data:', error);
                    showError('Failed to save data to storage. Your browser may not support localStorage or storage may be full.');
                }
            }
            
            // Show error message
            function showError(message) {
                // Create error indicator similar to save indicator
                const errorIndicator = document.createElement('div');
                errorIndicator.className = 'save-indicator';
                errorIndicator.style.backgroundColor = 'var(--accent)';
                errorIndicator.innerHTML = `<i class="fas fa-exclamation-circle"></i> ${message}`;
                document.body.appendChild(errorIndicator);
                
                setTimeout(() => {
                    errorIndicator.classList.add('show');
                    setTimeout(() => {
                        errorIndicator.classList.remove('show');
                        setTimeout(() => {
                            document.body.removeChild(errorIndicator);
                        }, 300);
                    }, 3000);
                }, 100);
            }
            
            // Render table with lesson data
            function renderTable() {
                lessonData.innerHTML = '';
                
                if (lessons.length === 0) {
                    showEmptyState();
                    return;
                }
                
                // Apply filters
                let filteredLessons = lessons.filter(lesson => {
                    if (currentFilters.subject !== 'all' && lesson.subject !== currentFilters.subject) return false;
                    if (currentFilters.week !== 'all' && lesson.week !== currentFilters.week) return false;
                    if (currentFilters.status !== 'all' && lesson.status !== currentFilters.status) return false;
                    if (currentFilters.search && !lesson.topic.toLowerCase().includes(currentFilters.search.toLowerCase())) return false;
                    return true;
                });
                
                if (filteredLessons.length === 0) {
                    lessonData.innerHTML = `
                        <tr>
                            <td colspan="6" style="text-align: center; padding: 20px; color: var(--gray);">
                                No lessons match the current filters. Try changing your filter settings.
                            </td>
                        </tr>
                    `;
                    return;
                }
                
                // Format subject names
                const subjectMap = {
                    'english': 'English',
                    'math': 'Math',
                    'science': 'Science',
                    'filipino': 'Filipino',
                    'ap': 'Araling Panlipunan',
                    'epp': 'EPP',
                    'gmrc': 'GMRC',
                    'mapeh': 'MAPEH'
                };
                
                filteredLessons.forEach(lesson => {
                    const row = document.createElement('tr');
                    
                    // Add completed class if lesson is completed
                    if (lesson.status === 'completed') {
                        row.classList.add('completed');
                    }
                    
                    row.innerHTML = `
                        <td>${subjectMap[lesson.subject]}</td>
                        <td>Week ${lesson.week}</td>
                        <td>Day ${lesson.day}</td>
                        <td>${lesson.topic}</td>
                        <td>
                            <span class="status-badge ${lesson.status === 'completed' ? 'status-completed' : 'status-pending'}">
                                ${lesson.status === 'completed' ? 'Completed' : 'Pending'}
                            </span>
                        </td>
                        <td>
                            <div class="action-buttons">
                                <button class="action-btn edit-btn" data-id="${lesson.id}">
                                    <i class="fas fa-edit"></i> Edit
                                </button>
                                <button class="action-btn delete-btn" data-id="${lesson.id}">
                                    <i class="fas fa-trash"></i> Delete
                                </button>
                            </div>
                        </td>
                    `;
                    
                    lessonData.appendChild(row);
                });
                
                // Add event listeners to action buttons
                document.querySelectorAll('.edit-btn').forEach(btn => {
                    btn.addEventListener('click', function() {
                        const id = this.getAttribute('data-id');
                        editLesson(id);
                    });
                });
                
                document.querySelectorAll('.delete-btn').forEach(btn => {
                    btn.addEventListener('click', function() {
                        const id = this.getAttribute('data-id');
                        showConfirmation('Are you sure you want to delete this lesson?', () => {
                            deleteLesson(id);
                        });
                    });
                });
            }
            
            // Edit a lesson
            function editLesson(id) {
                const lesson = lessons.find(l => l.id === id);
                if (!lesson) return;
                
                // Populate form with lesson data
                document.getElementById('subject').value = lesson.subject;
                document.getElementById('week').value = lesson.week;
                document.getElementById('day').value = lesson.day;
                document.getElementById('topic').value = lesson.topic;
                document.getElementById('status').value = lesson.status;
                document.getElementById('notes').value = lesson.notes || '';
                
                // Set edit mode
                editIdField.value = id;
                submitBtn.innerHTML = '<i class="fas fa-save"></i> Update Lesson';
                cancelEditBtn.style.display = 'inline-flex';
                
                // Scroll to form
                lessonForm.scrollIntoView({ behavior: 'smooth' });
            }
            
            // Cancel edit mode
            function cancelEdit() {
                editIdField.value = '';
                lessonForm.reset();
                submitBtn.innerHTML = '<i class="fas fa-plus"></i> Add Lesson';
                cancelEditBtn.style.display = 'none';
            }
            
            // Delete a lesson
            function deleteLesson(id) {
                lessons = lessons.filter(lesson => lesson.id !== id);
                saveData();
                renderTable();
            }
            
            // Show confirmation dialog
            function showConfirmation(message, callback) {
                confirmationMessage.textContent = message;
                pendingAction = callback;
                confirmationModal.style.display = 'flex';
            }
            
            // Handle form submission
            lessonForm.addEventListener('submit', function(e) {
                e.preventDefault();
                
                const subject = document.getElementById('subject').value;
                const week = document.getElementById('week').value;
                const day = document.getElementById('day').value;
                const topic = document.getElementById('topic').value;
                const status = document.getElementById('status').value;
                const notes = document.getElementById('notes').value;
                const editId = editIdField.value;
                
                // Validate for duplicates when adding new lesson
                if (!editId) {
                    const isDuplicate = lessons.some(lesson => 
                        lesson.subject === subject && 
                        lesson.week === week && 
                        lesson.day === day && 
                        lesson.topic === topic
                    );
                    
                    if (isDuplicate) {
                        showError('This lesson already exists!');
                        return;
                    }
                }
                
                if (editId) {
                    // Update existing lesson
                    const index = lessons.findIndex(lesson => lesson.id === editId);
                    if (index !== -1) {
                        lessons[index] = {
                            ...lessons[index],
                            subject,
                            week,
                            day,
                            topic,
                            status,
                            notes
                        };
                    }
                } else {
                    // Add new lesson
                    lessons.push({
                        id: Date.now().toString(), // Unique ID
                        subject,
                        week,
                        day,
                        topic,
                        status,
                        notes,
                        createdAt: new Date().toISOString()
                    });
                }
                
                // Save and render
                saveData();
                renderTable();
                
                // Reset form
                cancelEdit();
            });
            
            // Handle print button
            printBtn.addEventListener('click', function() {
                window.print();
            });
            
            // Handle PDF export button
            pdfBtn.addEventListener('click', function() {
                // Create a new jsPDF instance
                const doc = new jsPDF();
                
                // Add title
                doc.setFontSize(20);
                doc.text('Lesson Tracker', 14, 15);
                doc.setFontSize(12);
                doc.setTextColor(100);
                
                // Add filters info if any are applied
                let filtersText = 'All Lessons';
                if (currentFilters.subject !== 'all' || currentFilters.week !== 'all' || currentFilters.status !== 'all' || currentFilters.search) {
                    filtersText = 'Filtered Lessons';
                    
                    if (currentFilters.subject !== 'all') {
                        filtersText += ` | Subject: ${document.getElementById('filter-subject').options[document.getElementById('filter-subject').selectedIndex].text}`;
                    }
                    if (currentFilters.week !== 'all') {
                        filtersText += ` | Week: ${currentFilters.week}`;
                    }
                    if (currentFilters.status !== 'all') {
                        filtersText += ` | Status: ${currentFilters.status}`;
                    }
                    if (currentFilters.search) {
                        filtersText += ` | Search: ${currentFilters.search}`;
                    }
                }
                
                doc.text(filtersText, 14, 22);
                
                // Get filtered data for PDF
                let filteredLessons = lessons.filter(lesson => {
                    if (currentFilters.subject !== 'all' && lesson.subject !== currentFilters.subject) return false;
                    if (currentFilters.week !== 'all' && lesson.week !== currentFilters.week) return false;
                    if (currentFilters.status !== 'all' && lesson.status !== currentFilters.status) return false;
                    if (currentFilters.search && !lesson.topic.toLowerCase().includes(currentFilters.search.toLowerCase())) return false;
                    return true;
                });
                
                // Format data for PDF table
                const tableColumn = ["Subject", "Week", "Day", "Topic", "Status"];
                const tableRows = [];
                
                // Format subject names for PDF
                const subjectMap = {
                    'english': 'English',
                    'math': 'Math',
                    'science': 'Science',
                    'filipino': 'Filipino',
                    'ap': 'Araling Panlipunan',
                    'epp': 'EPP',
                    'gmrc': 'GMRC',
                    'mapeh': 'MAPEH'
                };
                
                filteredLessons.forEach(lesson => {
                    const lessonData = [
                        subjectMap[lesson.subject],
                        `Week ${lesson.week}`,
                        `Day ${lesson.day}`,
                        lesson.topic,
                        lesson.status === 'completed' ? 'Completed' : 'Pending'
                    ];
                    tableRows.push(lessonData);
                });
                
                // Add table to PDF
                doc.autoTable({
                    head: [tableColumn],
                    body: tableRows,
                    startY: 30,
                    theme: 'grid',
                    styles: {
                        fontSize: 10,
                        cellPadding: 3,
                    },
                    headStyles: {
                        fillColor: [52, 152, 219],
                        textColor: 255,
                        fontStyle: 'bold'
                    },
                    alternateRowStyles: {
                        fillColor: [240, 240, 240]
                    }
                });
                
                // Save the PDF
                const date = new Date();
                const dateString = `${date.getFullYear()}-${date.getMonth()+1}-${date.getDate()}`;
                doc.save(`lesson-tracker-${dateString}.pdf`);
            });
            
            // Handle reset button
            resetBtn.addEventListener('click', function() {
                showConfirmation('Are you sure you want to clear all lesson data? This cannot be undone.', () => {
                    lessons = [];
                    saveData();
                    renderTable();
                    cancelEdit();
                });
            });
            
            // Handle filter application
            applyFilters.addEventListener('click', function() {
                currentFilters.subject = filterSubject.value;
                currentFilters.week = filterWeek.value;
                currentFilters.status = filterStatus.value;
                currentFilters.search = searchInput.value;
                renderTable();
            });
            
            // Handle clear filters
            clearFilters.addEventListener('click', function() {
                filterSubject.value = 'all';
                filterWeek.value = 'all';
                filterStatus.value = 'all';
                searchInput.value = '';
                currentFilters = {
                    subject: 'all',
                    week: 'all',
                    status: 'all',
                    search: ''
                };
                renderTable();
            });
            
            // Handle cancel edit
            cancelEditBtn.addEventListener('click', cancelEdit);
            
            // Handle export JSON
            exportJsonBtn.addEventListener('click', function() {
                const dataStr = JSON.stringify(lessons, null, 2);
                const dataUri = 'data:application/json;charset=utf-8,'+ encodeURIComponent(dataStr);
                
                const exportFileDefaultName = `lessons-${new Date().toISOString().slice(0, 10)}.json`;
                
                const linkElement = document.createElement('a');
                linkElement.setAttribute('href', dataUri);
                linkElement.setAttribute('download', exportFileDefaultName);
                linkElement.click();
            });
            
            // Handle import JSON
            importJsonBtn.addEventListener('click', function() {
                importFileInput.click();
            });
            
            importFileInput.addEventListener('change', function(event) {
                const file = event.target.files[0];
                if (!file) return;
                
                const reader = new FileReader();
                reader.onload = function(e) {
                    try {
                        const importedData = JSON.parse(e.target.result);
                        
                        // Validate imported data
                        if (!Array.isArray(importedData)) {
                            throw new Error('Imported data is not valid');
                        }
                        
                        // Check if data has expected structure
                        const isValid = importedData.every(item => 
                            item && 
                            typeof item.subject === 'string' && 
                            typeof item.week === 'string' && 
                            typeof item.day === 'string' && 
                            typeof item.topic === 'string'
                        );
                        
                        if (!isValid) {
                            throw new Error('Imported data has invalid structure');
                        }
                        
                        showConfirmation(`Import ${importedData.length} lessons? This will replace your current data.`, () => {
                            lessons = importedData;
                            
                            // Ensure all lessons have IDs
                            lessons.forEach(lesson => {
                                if (!lesson.id) {
                                    lesson.id = Date.now().toString();
                                }
                            });
                            
                            saveData();
                            renderTable();
                            // Reset file input
                            importFileInput.value = '';
                        });
                    } catch (error) {
                        console.error('Error importing data:', error);
                        showError('Failed to import data. The file may be corrupted or in an invalid format.');
                        // Reset file input
                        importFileInput.value = '';
                    }
                };
                reader.readAsText(file);
            });
            
            // Handle confirmation modal
            confirmActionBtn.addEventListener('click', function() {
                if (pendingAction) {
                    pendingAction();
                }
                confirmationModal.style.display = 'none';
                pendingAction = null;
            });
            
            cancelActionBtn.addEventListener('click', function() {
                confirmationModal.style.display = 'none';
                pendingAction = null;
            });
            
            modalCloseBtn.addEventListener('click', function() {
                confirmationModal.style.display = 'none';
                pendingAction = null;
            });
            
            // Close modal when clicking outside
            window.addEventListener('click', function(event) {
                if (event.target === confirmationModal) {
                    confirmationModal.style.display = 'none';
                    pendingAction = null;
                }
            });
            
            // Initialize the app
            loadData();
        });
    </script>
</body>
</html>
