<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lesson Tracker</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.28/jspdf.plugin.autotable.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&family=Roboto:wght@300;400&display=swap" rel="stylesheet">
    <style>
        :root {
            --neon-blue: #00ffff;
            --cyber-purple: #ff00ff;
            --dark-bg: #0a0a2a;
            --light-glow: #ffffff20;
            --accent-green: #00ff9f;
            --warning-orange: #ff9500;
            --error-red: #ff4d4d;
            --surface: rgba(255, 255, 255, 0.05);
            --text-primary: #ffffff;
            --text-secondary: #b3b3b3;
            --border-glow: rgba(0, 255, 255, 0.3);
            --shadow-glow: 0 0 20px rgba(0, 255, 255, 0.2);
            --card-shadow: 0 8px 32px rgba(0, 0, 0, 0.37);
            --transition: all 0.3s ease-in-out;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Orbitron', sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, var(--dark-bg) 0%, #1a1a4a 100%);
            color: var(--text-primary);
            line-height: 1.6;
            min-height: 100vh;
            padding: 20px;
            overflow-x: hidden;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: var(--surface);
            border-radius: 20px;
            box-shadow: var(--shadow-glow), var(--card-shadow);
            overflow: hidden;
            backdrop-filter: blur(10px);
            border: 1px solid var(--border-glow);
        }
        
        header {
            background: linear-gradient(120deg, var(--neon-blue) 0%, var(--cyber-purple) 100%);
            color: var(--text-primary);
            padding: 30px;
            text-align: center;
            position: relative;
            clip-path: polygon(0 0, 100% 0, 100% 85%, 0 100%);
        }
        
        .offline-badge {
            position: absolute;
            top: 15px;
            right: 15px;
            background: var(--light-glow);
            padding: 8px 15px;
            border-radius: 30px;
            font-size: 14px;
            display: flex;
            align-items: center;
            box-shadow: var(--shadow-glow);
        }
        
        .offline-badge i {
            margin-right: 8px;
            color: var(--neon-blue);
        }
        
        .logo {
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 20px;
            animation: glow 2s infinite alternate;
        }
        
        @keyframes glow {
            from { text-shadow: 0 0 5px var(--neon-blue); }
            to { text-shadow: 0 0 15px var(--neon-blue); }
        }
        
        .logo i {
            font-size: 40px;
            margin-right: 20px;
            color: var(--neon-blue);
            text-shadow: 0 0 10px var(--neon-blue);
        }
        
        h1 {
            font-size: 36px;
            margin-bottom: 15px;
            text-transform: uppercase;
            letter-spacing: 2px;
        }
        
        .subtitle {
            font-size: 18px;
            opacity: 0.8;
            font-family: 'Roboto', sans-serif;
        }
        
        .storage-info {
            background: var(--light-glow);
            padding: 12px;
            border-radius: 10px;
            margin-top: 20px;
            font-size: 16px;
            box-shadow: var(--shadow-glow);
        }
        
        .content-area {
            padding: 30px;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .stat-card {
            background: var(--surface);
            padding: 20px;
            border-radius: 12px;
            box-shadow: var(--card-shadow), var(--shadow-glow);
            text-align: center;
            border: 1px solid var(--border-glow);
            transition: var(--transition);
        }
        
        .stat-card:hover {
            transform: scale(1.05);
            box-shadow: 0 0 30px var(--neon-blue);
        }
        
        .stat-card.warning {
            border-color: var(--warning-orange);
        }
        
        .stat-card.accent {
            border-color: var(--error-red);
        }
        
        .stat-card.secondary {
            border-color: var(--accent-green);
        }
        
        .stat-value {
            font-size: 28px;
            font-weight: bold;
            margin: 12px 0;
            color: var(--neon-blue);
        }
        
        .stat-label {
            font-size: 16px;
            color: var(--text-secondary);
            font-family: 'Roboto', sans-serif;
        }
        
        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 25px;
            margin-bottom: 35px;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 10px;
            font-weight: 700;
            color: var(--text-primary);
            letter-spacing: 1px;
        }
        
        .form-control {
            width: 100%;
            padding: 14px 18px;
            border: 1px solid var(--border-glow);
            border-radius: 8px;
            font-size: 16px;
            background: var(--surface);
            color: var(--text-primary);
            transition: var(--transition);
            box-shadow: inset 0 0 10px rgba(0, 0, 0, 0.1);
        }
        
        .form-control:focus {
            outline: none;
            border-color: var(--neon-blue);
            box-shadow: 0 0 15px var(--neon-blue);
        }
        
        .btn {
            padding: 14px 24px;
            color: var(--text-primary);
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 700;
            transition: var(--transition);
            display: inline-flex;
            align-items: center;
            justify-content: center;
            margin-right: 12px;
            margin-bottom: 12px;
            background: linear-gradient(45deg, var(--neon-blue), var(--cyber-purple));
            box-shadow: var(--shadow-glow);
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        .btn i {
            margin-right: 10px;
        }
        
        .btn:hover {
            transform: translateY(-3px) scale(1.02);
            box-shadow: 0 0 25px var(--neon-blue);
        }
        
        .btn-primary {
            background: linear-gradient(45deg, var(--neon-blue), #00bfff);
        }
        
        .btn-secondary {
            background: linear-gradient(45deg, var(--accent-green), #00ff00);
        }
        
        .btn-accent {
            background: linear-gradient(45deg, var(--error-red), #ff0000);
        }
        
        .btn-warning {
            background: linear-gradient(45deg, var(--warning-orange), #ffa500);
        }
        
        .btn-pdf {
            background: linear-gradient(45deg, #ff4d4d, #e60000);
        }
        
        .btn-json {
            background: linear-gradient(45deg, #9b59b6, #800080);
        }
        
        .form-actions {
            display: flex;
            gap: 18px;
            flex-wrap: wrap;
            margin-bottom: 25px;
        }
        
        .data-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 35px;
            background: var(--surface);
            border-radius: 15px;
            overflow: hidden;
            box-shadow: var(--card-shadow), var(--shadow-glow);
        }
        
        .data-table th, .data-table td {
            padding: 18px 24px;
            text-align: left;
            border-bottom: 1px solid var(--border-glow);
        }
        
        .data-table th {
            background: linear-gradient(90deg, var(--neon-blue) 0%, var(--cyber-purple) 100%);
            color: var(--text-primary);
            font-weight: 700;
            text-transform: uppercase;
        }
        
        .data-table tr:last-child td {
            border-bottom: none;
        }
        
        .data-table tr:hover {
            background: rgba(0, 255, 255, 0.1);
            box-shadow: inset 0 0 10px var(--neon-blue);
        }
        
        .action-buttons {
            display: flex;
            gap: 10px;
        }
        
        .action-btn {
            padding: 8px 12px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            display: inline-flex;
            align-items: center;
            transition: var(--transition);
        }
        
        .edit-btn {
            background: var(--warning-orange);
            color: var(--text-primary);
        }
        
        .delete-btn {
            background: var(--error-red);
            color: var(--text-primary);
        }
        
        .action-btn:hover {
            transform: scale(1.1);
            box-shadow: 0 0 15px currentColor;
        }
        
        .footer {
            text-align: center;
            margin-top: 35px;
            color: var(--text-secondary);
            font-size: 16px;
            padding: 25px;
            border-top: 1px solid var(--border-glow);
            font-family: 'Roboto', sans-serif;
        }
        
        .save-indicator {
            position: fixed;
            bottom: 25px;
            right: 25px;
            padding: 14px 20px;
            background: var(--accent-green);
            color: var(--text-primary);
            border-radius: 8px;
            font-weight: 600;
            box-shadow: var(--shadow-glow);
            opacity: 0;
            transition: opacity 0.3s ease, transform 0.3s ease;
            display: flex;
            align-items: center;
            z-index: 1000;
            transform: translateY(20px);
        }
        
        .save-indicator.show {
            opacity: 1;
            transform: translateY(0);
        }
        
        .save-indicator i {
            margin-right: 10px;
        }
        
        .filter-controls {
            display: flex;
            gap: 18px;
            margin-bottom: 25px;
            flex-wrap: wrap;
            align-items: center;
        }
        
        .filter-controls select, .filter-controls input {
            padding: 12px 18px;
            border: 1px solid var(--border-glow);
            border-radius: 8px;
            font-size: 16px;
            background: var(--surface);
            color: var(--text-primary);
        }
        
        .storage-status {
            background: var(--surface);
            padding: 20px;
            border-radius: 12px;
            margin-top: 25px;
            border-left: 5px solid var(--neon-blue);
            box-shadow: var(--shadow-glow);
        }
        
        .import-export {
            margin-top: 25px;
            padding: 20px;
            background: var(--surface);
            border-radius: 12px;
            border-left: 5px solid var(--cyber-purple);
            box-shadow: var(--shadow-glow);
        }
        
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            z-index: 2000;
            align-items: center;
            justify-content: center;
        }
        
        .modal-content {
            background: var(--surface);
            padding: 30px;
            border-radius: 15px;
            width: 90%;
            max-width: 600px;
            box-shadow: var(--shadow-glow), var(--card-shadow);
            border: 1px solid var(--border-glow);
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
        }
        
        .modal-close {
            background: none;
            border: none;
            font-size: 28px;
            cursor: pointer;
            color: var(--text-secondary);
            transition: var(--transition);
        }
        
        .modal-close:hover {
            color: var(--neon-blue);
        }
        
        .confirmation-modal .btn {
            margin-top: 25px;
        }
        
        /* Print styles */
        @media print {
            body {
                background: white;
                padding: 0;
                color: black;
            }
            
            .container {
                box-shadow: none;
                border-radius: 0;
                background: white;
            }
            
            header {
                background: white !important;
                color: black !important;
                padding: 20px;
                border-bottom: 2px solid #000;
            }
            
            .offline-badge, .stats-grid, .form-grid, .form-actions, .footer, 
            .filter-controls, .storage-status, .import-export, .action-buttons {
                display: none !important;
            }
            
            .content-area {
                padding: 15px;
            }
            
            .data-table {
                box-shadow: none;
                page-break-inside: avoid;
            }
            
            .data-table th {
                background-color: white !important;
                color: black !important;
                border-bottom: 2px solid black;
            }
            
            .print-header {
                text-align: center;
                margin-bottom: 20px;
            }
            
            .print-title {
                font-size: 24px;
                margin-bottom: 10px;
                color: black;
            }
            
            .print-subtitle {
                font-size: 16px;
                color: gray;
                margin-bottom: 20px;
            }
        }
        
        @media (max-width: 768px) {
            .form-grid {
                grid-template-columns: 1fr;
            }
            
            .stats-grid {
                grid-template-columns: 1fr 1fr;
            }
            
            .form-actions, .filter-controls {
                flex-direction: column;
                align-items: stretch;
            }
            
            .btn {
                width: 100%;
                margin-right: 0;
            }
            
            .data-table {
                display: block;
                overflow-x: auto;
            }
            
            .offline-badge {
                position: relative;
                top: 0;
                right: 0;
                margin: 10px auto;
                width: fit-content;
            }
            
            .action-buttons {
                flex-direction: column;
                gap: 5px;
            }
            
            .action-btn {
                width: 100%;
                justify-content: center;
            }
        }
        
        @media (max-width: 480px) {
            .stats-grid {
                grid-template-columns: 1fr;
            }
            
            header {
                padding: 15px;
            }
            
            .logo {
                flex-direction: column;
                text-align: center;
            }
            
            .logo i {
                margin-right: 0;
                margin-bottom: 10px;
            }
        }
        
        .empty-state {
            text-align: center;
            padding: 50px 25px;
            color: var(--text-secondary);
        }
        
        .empty-state i {
            font-size: 80px;
            margin-bottom: 20px;
            opacity: 0.5;
        }
        
        .status-badge {
            padding: 6px 10px;
            border-radius: 6px;
            font-size: 14px;
            font-weight: 700;
        }
        
        .status-completed {
            background: rgba(0, 255, 159, 0.2);
            color: var(--accent-green);
        }
        
        .status-pending {
            background: rgba(255, 149, 0, 0.2);
            color: var(--warning-orange);
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <div class="offline-badge">
                <i class="fas fa-wifi-slash"></i> Works Offline
            </div>
            <div class="logo">
                <i class="fas fa-book-open"></i>
                <div>
                    <h1>Lesson Tracker 2030</h1>
                    <p class="subtitle">Grade 5 MATATAG Curriculum - Local Storage Powered</p>
                </div>
            </div>
            <div class="storage-info">
                <i class="fas fa-database"></i> Data Secured Locally in Browser
            </div>
        </header>
        
        <div class="content-area">
            <div class="stats-grid" id="stats-container">
                <!-- Stats will be populated by JavaScript -->
            </div>
            
            <form id="lesson-form">
                <input type="hidden" id="edit-id" value="">
                
                <div class="form-grid">
                    <div class="form-group">
                        <label for="subject">Subject</label>
                        <select class="form-control" id="subject" required>
                            <option value="">Select Subject</option>
                            <option value="english">English</option>
                            <option value="math">Mathematics</option>
                            <option value="science">Science</option>
                            <option value="filipino">Filipino</option>
                            <option value="ap">Araling Panlipunan</option>
                            <option value="epp">EPP</option>
                            <option value="gmrc">GMRC</option>
                            <option value="mapeh">MAPEH</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="week">Week</label>
                        <select class="form-control" id="week" required>
                            <option value="">Select Week</option>
                            <option value="1">Week 1</option>
                            <option value="2">Week 2</option>
                            <option value="3">Week 3</option>
                            <option value="4">Week 4</option>
                            <option value="5">Week 5</option>
                            <option value="6">Week 6</option>
                            <option value="7">Week 7</option>
                            <option value="8">Week 8</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="day">Day</label>
                        <select class="form-control" id="day" required>
                            <option value="">Select Day</option>
                            <option value="1">Day 1</option>
                            <option value="2">Day 2</option>
                            <option value="3">Day 3</option>
                            <option value="4">Day 4</option>
                            <option value="5">Day 5</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="status">Status</label>
                        <select class="form-control" id="status" required>
                            <option value="pending">Pending</option>
                            <option value="completed">Completed</option>
                        </select>
                    </div>
                    
                    <div class="form-group" id="topic-group">
                        <label for="topic">Topic (MATATAG Curriculum)</label>
                        <select class="form-control" id="topic" required>
                            <option value="">Select Topic</option>
                            <!-- Topics populated dynamically -->
                        </select>
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="notes">Notes (Optional)</label>
                    <textarea class="form-control" id="notes" placeholder="Add notes or customizations" rows="4"></textarea>
                </div>
                
                <div class="form-actions">
                    <button type="submit" class="btn btn-primary" id="submit-btn">
                        <i class="fas fa-plus"></i> Add Lesson
                    </button>
                    <button type="button" class="btn btn-secondary" id="cancel-edit-btn" style="display: none;">
                        <i class="fas fa-times"></i> Cancel Edit
                    </button>
                    <button type="button" class="btn btn-secondary" id="print-btn">
                        <i class="fas fa-print"></i> Print
                    </button>
                    <button type="button" class="btn btn-pdf" id="pdf-btn">
                        <i class="fas fa-file-pdf"></i> Export PDF
                    </button>
                    <button type="button" class="btn btn-json" id="export-json-btn">
                        <i class="fas fa-file-export"></i> Export JSON
                    </button>
                    <button type="button" class="btn btn-warning" id="import-json-btn">
                        <i class="fas fa-file-import"></i> Import JSON
                    </button>
                    <button type="button" class="btn btn-accent" id="reset-btn">
                        <i class="fas fa-trash"></i> Clear All
                    </button>
                </div>
            </form>
            
            <div class="filter-controls">
                <div>
                    <label for="filter-subject">Subject:</label>
                    <select id="filter-subject">
                        <option value="all">All Subjects</option>
                        <option value="english">English</option>
                        <option value="math">Mathematics</option>
                        <option value="science">Science</option>
                        <option value="filipino">Filipino</option>
                        <option value="ap">Araling Panlipunan</option>
                        <option value="epp">EPP</option>
                        <option value="gmrc">GMRC</option>
                        <option value="mapeh">MAPEH</option>
                    </select>
                </div>
                
                <div>
                    <label for="filter-week">Week:</label>
                    <select id="filter-week">
                        <option value="all">All Weeks</option>
                        <option value="1">Week 1</option>
                        <option value="2">Week 2</option>
                        <option value="3">Week 3</option>
                        <option value="4">Week 4</option>
                        <option value="5">Week 5</option>
                        <option value="6">Week 6</option>
                        <option value="7">Week 7</option>
                        <option value="8">Week 8</option>
                    </select>
                </div>
                
                <div>
                    <label for="filter-status">Status:</label>
                    <select id="filter-status">
                        <option value="all">All Status</option>
                        <option value="pending">Pending</option>
                        <option value="completed">Completed</option>
                    </select>
                </div>
                
                <div>
                    <label for="search">Search:</label>
                    <input type="text" id="search" placeholder="Search topics...">
                </div>
                
                <button class="btn btn-primary" id="apply-filters">
                    <i class="fas fa-filter"></i> Apply
                </button>
                
                <button class="btn btn-secondary" id="clear-filters">
                    <i class="fas fa-times"></i> Clear
                </button>
            </div>
            
            <div class="print-header">
                <h2 class="print-title">Lesson Tracker 2030</h2>
                <p class="print-subtitle">Grade 5 MATATAG Curriculum Progress</p>
            </div>
            
            <table class="data-table">
                <thead>
                    <tr>
                        <th>Subject</th>
                        <th>Week</th>
                        <th>Day</th>
                        <th>Topic</th>
                        <th>Status</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody id="lesson-data">
                    <!-- Data will be populated here -->
                </tbody>
            </table>
            
            <div class="storage-status">
                <h3><i class="fas fa-info-circle"></i> Secure Local Storage</h3>
                <p>Your data is encrypted and stored locally:</p>
                <ul>
                    <li>Offline functionality</li>
                    <li>Full privacy - no servers involved</li>
                    <li>Persistent across sessions</li>
                    <li>Easy backup via export</li>
                </ul>
            </div>
            
            <div class="import-export">
                <h3><i class="fas fa-file-import"></i> Data Management</h3>
                <p>Export/Import JSON for backups or device transfer.</p>
                <input type="file" id="import-file" accept=".json" style="display: none;">
            </div>
        </div>
        
        <div class="footer">
            <p>Lesson Tracker 2030 &copy; 2025 | Grade 5 MATATAG Curriculum - Offline Ready</p>
        </div>
        
        <div class="save-indicator" id="save-indicator">
            <i class="fas fa-check-circle"></i> Data Secured
        </div>
        
        <!-- Confirmation Modal -->
        <div class="modal confirmation-modal" id="confirmation-modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h3>Confirm Action</h3>
                    <button class="modal-close">&times;</button>
                </div>
                <p id="confirmation-message">Are you sure?</p>
                <div>
                    <button class="btn btn-accent" id="confirm-action">Confirm</button>
                    <button class="btn btn-secondary" id="cancel-action">Cancel</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Initialize jsPDF
        window.jsPDF = window.jspdf.jsPDF;
        
        document.addEventListener('DOMContentLoaded', function() {
            const lessonForm = document.getElementById('lesson-form');
            const lessonData = document.getElementById('lesson-data');
            const printBtn = document.getElementById('print-btn');
            const pdfBtn = document.getElementById('pdf-btn');
            const resetBtn = document.getElementById('reset-btn');
            const saveIndicator = document.getElementById('save-indicator');
            const filterSubject = document.getElementById('filter-subject');
            const filterWeek = document.getElementById('filter-week');
            const filterStatus = document.getElementById('filter-status');
            const searchInput = document.getElementById('search');
            const applyFilters = document.getElementById('apply-filters');
            const clearFilters = document.getElementById('clear-filters');
            const submitBtn = document.getElementById('submit-btn');
            const cancelEditBtn = document.getElementById('cancel-edit-btn');
            const editIdField = document.getElementById('edit-id');
            const exportJsonBtn = document.getElementById('export-json-btn');
            const importJsonBtn = document.getElementById('import-json-btn');
            const importFileInput = document.getElementById('import-file');
            const statsContainer = document.getElementById('stats-container');
            const confirmationModal = document.getElementById('confirmation-modal');
            const confirmActionBtn = document.getElementById('confirm-action');
            const cancelActionBtn = document.getElementById('cancel-action');
            const confirmationMessage = document.getElementById('confirmation-message');
            const modalCloseBtn = document.querySelector('.modal-close');
            const subjectSelect = document.getElementById('subject');
            const weekSelect = document.getElementById('week');
            const daySelect = document.getElementById('day');
            const topicSelect = document.getElementById('topic');
            
            let lessons = [];
            let currentFilters = {
                subject: 'all',
                week: 'all',
                status: 'all',
                search: ''
            };
            let pendingAction = null;
            
            // MATATAG Grade 5 Curriculum Topics (Simplified example data; expand as needed)
            const curriculumTopics = {
                english: {
                    1: { // Week 1
                        1: 'Using Complex Sentences to Show Cause and Effect',
                        2: 'Using Compound Sentences to Show Problem-Solution Relationship of Ideas',
                        3: 'Using Compound Sentences to Show Cause-Effect Relationship of Ideas',
                        4: 'Using Prepositions in, on, at, and by',
                        5: 'Recognizing Adverbs of Manner and Frequency'
                    },
                    2: { // Week 2
                        1: 'Composing Clear and Coherent Sentences Using Adverbs of Frequency and Manner',
                        2: 'Filling-out Forms Accurately and Efficiently (school forms)',
                        3: 'Planning a Composition Using an Outline/Other Graphic Organizers',
                        4: 'Revising Writing for Clarity -appropriate punctuation marks -transition/signal words',
                        5: 'Reading Texts with Appropriate Speed, Accuracy, and Proper Expression'
                    },
                    // Add more weeks...
                },
                math: {
                    1: {
                        1: 'Visualizing Numbers up to 10 000 000 with Emphasis on Numbers 100 001 – 10 000 000',
                        2: 'Reading and Writing Numbers up to 10 000 000 in Numerals and in Words',
                        3: 'Rounding Numbers to the Nearest Hundred Thousand',
                        4: 'Comparing Numbers up to 10 000 000 Using Relation Symbols',
                        5: 'Ordering Numbers up to 10 000 000 in Increasing or Decreasing Order'
                    },
                    // Add more...
                },
                science: {
                    1: {
                        1: 'Using a Microscope',
                        2: 'Identifying Parts of a Microscope and their Functions',
                        3: 'Focusing Specimens on Low Power Objective',
                        4: 'Preparing Materials for Microscope Use',
                        5: 'Observing and Describing Changes in Materials Over Time'
                    },
                    // Add more...
                },
                filipino: {
                    1: {
                        1: 'Pagkilala sa mga Salitang Magkasingkahulugan at Magkasalungat',
                        2: 'Paggamit ng mga Salitang Magkasingkahulugan sa Pangungusap',
                        3: 'Paggamit ng mga Salitang Magkasalungat sa Pangungusap',
                        4: 'Pagbuo ng mga Pangungusap Gamit ang mga Salitang Nagpapahayag ng Opinyon',
                        5: 'Pagbuo ng mga Pangungusap Gamit ang mga Salitang Nagpapahayag ng Katotohanan'
                    },
                    // Add more...
                },
                ap: {
                    1: {
                        1: 'Mga Hamon sa Buhay at Paano Ito Malalampasan',
                        2: 'Mga Hakbang sa Paglutas ng Suliranin',
                        3: 'Pagkakaiba ng Pangangailangan at Kagustuhan',
                        4: 'Mga Yamang Likas ng Pilipinas',
                        5: 'Mga Yamang Tao ng Pilipinas'
                    },
                    // Add more...
                },
                epp: {
                    1: {
                        1: 'Kahalagahan ng Agrikultura',
                        2: 'Mga Halimbawa ng Produktong Agrikultural',
                        3: 'Pangangalaga sa Halaman at Hayop',
                        4: 'Paggamit ng Teknolohiya sa Agrikultura',
                        5: 'Sustainability sa Pagsasaka'
                    },
                    // Add more...
                },
                gmrc: {
                    1: {
                        1: 'Pagkilala sa Sarili at Emosyon',
                        2: 'Pagpapahalaga sa Pamilya',
                        3: 'Paggalang sa Kapwa',
                        4: 'Responsibilidad sa Paaralan',
                        5: 'Pagiging Matapat'
                    },
                    // Add more...
                },
                mapeh: {
                    1: {
                        1: 'Music: Rhythm and Melody',
                        2: 'Arts: Basic Drawing Techniques',
                        3: 'PE: Physical Fitness Activities',
                        4: 'Health: Personal Hygiene',
                        5: 'Integrated MAPEH Project'
                    },
                    // Add more...
                }
                // Expand for all weeks (1-8) and days as per actual curriculum
            };
            
            // Function to populate topics based on selections
            function populateTopics() {
                const subject = subjectSelect.value;
                const week = weekSelect.value;
                const day = daySelect.value;
                topicSelect.innerHTML = '<option value="">Select Topic</option>';
                
                if (subject && week && day && curriculumTopics[subject] && curriculumTopics[subject][week] && curriculumTopics[subject][week][day]) {
                    const topic = curriculumTopics[subject][week][day];
                    topicSelect.innerHTML += `<option value="${topic}">${topic}</option>`;
                    // If more topics per day, add loops here
                } else {
                    topicSelect.innerHTML += '<option value="">No predefined topic - Enter custom</option>';
                    // Allow custom input if no predefined
                    topicSelect.outerHTML = '<input type="text" class="form-control" id="topic" placeholder="Enter custom topic" required>';
                }
            }
            
            // Event listeners for dynamic topic population
            subjectSelect.addEventListener('change', populateTopics);
            weekSelect.addEventListener('change', populateTopics);
            daySelect.addEventListener('change', populateTopics);
            
            // Load data from localStorage
            function loadData() {
                try {
                    const savedData = localStorage.getItem('lessonData');
                    if (savedData) {
                        lessons = JSON.parse(savedData);
                        renderTable();
                        updateStats();
                    } else {
                        showEmptyState();
                        updateStats();
                    }
                } catch (error) {
                    console.error('Error loading data:', error);
                    showError('Failed to load data from storage');
                    lessons = [];
                    showEmptyState();
                }
            }
            
            // Show empty state
            function showEmptyState() {
                lessonData.innerHTML = `
                    <tr>
                        <td colspan="6" class="empty-state">
                            <i class="fas fa-inbox"></i>
                            <h3>No Lessons Yet</h3>
                            <p>Add using the form above.</p>
                        </td>
                    </tr>
                `;
            }
            
            // Update statistics
            function updateStats() {
                const totalLessons = lessons.length;
                const completedLessons = lessons.filter(lesson => lesson.status === 'completed').length;
                const pendingLessons = totalLessons - completedLessons;
                const completionRate = totalLessons > 0 ? Math.round((completedLessons / totalLessons) * 100) : 0;
                
                statsContainer.innerHTML = `
                    <div class="stat-card">
                        <div class="stat-label">Total Lessons</div>
                        <div class="stat-value">${totalLessons}</div>
                    </div>
                    <div class="stat-card secondary">
                        <div class="stat-label">Completed</div>
                        <div class="stat-value">${completedLessons}</div>
                    </div>
                    <div class="stat-card warning">
                        <div class="stat-label">Pending</div>
                        <div class="stat-value">${pendingLessons}</div>
                    </div>
                    <div class="stat-card accent">
                        <div class="stat-label">Completion Rate</div>
                        <div class="stat-value">${completionRate}%</div>
                    </div>
                `;
            }
            
            // Save data to localStorage
            function saveData() {
                try {
                    localStorage.setItem('lessonData', JSON.stringify(lessons));
                    
                    // Show save indicator
                    saveIndicator.classList.add('show');
                    setTimeout(() => {
                        saveIndicator.classList.remove('show');
                    }, 2000);
                    
                    updateStats();
                } catch (error) {
                    console.error('Error saving data:', error);
                    showError('Failed to save. Storage may be full.');
                }
            }
            
            // Show error message
            function showError(message) {
                const errorIndicator = document.createElement('div');
                errorIndicator.className = 'save-indicator';
                errorIndicator.style.background = 'linear-gradient(45deg, var(--error-red), #cc0000)';
                errorIndicator.innerHTML = `<i class="fas fa-exclamation-circle"></i> ${message}`;
                document.body.appendChild(errorIndicator);
                
                setTimeout(() => {
                    errorIndicator.classList.add('show');
                    setTimeout(() => {
                        errorIndicator.classList.remove('show');
                        setTimeout(() => {
                            document.body.removeChild(errorIndicator);
                        }, 300);
                    }, 3000);
                }, 100);
            }
            
            // Render table
            function renderTable() {
                lessonData.innerHTML = '';
                
                if (lessons.length === 0) {
                    showEmptyState();
                    return;
                }
                
                let filteredLessons = lessons.filter(lesson => {
                    if (currentFilters.subject !== 'all' && lesson.subject !== currentFilters.subject) return false;
                    if (currentFilters.week !== 'all' && lesson.week !== currentFilters.week) return false;
                    if (currentFilters.status !== 'all' && lesson.status !== currentFilters.status) return false;
                    if (currentFilters.search && !lesson.topic.toLowerCase().includes(currentFilters.search.toLowerCase())) return false;
                    return true;
                });
                
                if (filteredLessons.length === 0) {
                    lessonData.innerHTML = `
                        <tr>
                            <td colspan="6" style="text-align: center; padding: 20px; color: var(--text-secondary);">
                                No matching lessons. Adjust filters.
                            </td>
                        </tr>
                    `;
                    return;
                }
                
                const subjectMap = {
                    'english': 'English',
                    'math': 'Mathematics',
                    'science': 'Science',
                    'filipino': 'Filipino',
                    'ap': 'Araling Panlipunan',
                    'epp': 'EPP',
                    'gmrc': 'GMRC',
                    'mapeh': 'MAPEH'
                };
                
                filteredLessons.forEach(lesson => {
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${subjectMap[lesson.subject] || lesson.subject}</td>
                        <td>Week ${lesson.week}</td>
                        <td>Day ${lesson.day}</td>
                        <td>${lesson.topic}</td>
                        <td>
                            <span class="status-badge ${lesson.status === 'completed' ? 'status-completed' : 'status-pending'}">
                                ${lesson.status.charAt(0).toUpperCase() + lesson.status.slice(1)}
                            </span>
                        </td>
                        <td>
                            <div class="action-buttons">
                                <button class="action-btn edit-btn" data-id="${lesson.id}">
                                    <i class="fas fa-edit"></i> Edit
                                </button>
                                <button class="action-btn delete-btn" data-id="${lesson.id}">
                                    <i class="fas fa-trash"></i> Delete
                                </button>
                            </div>
                        </td>
                    `;
                    lessonData.appendChild(row);
                });
                
                document.querySelectorAll('.edit-btn').forEach(btn => {
                    btn.addEventListener('click', function() {
                        const id = this.getAttribute('data-id');
                        editLesson(id);
                    });
                });
                
                document.querySelectorAll('.delete-btn').forEach(btn => {
                    btn.addEventListener('click', function() {
                        const id = this.getAttribute('data-id');
                        showConfirmation('Delete this lesson?', () => deleteLesson(id));
                    });
                });
            }
            
            // Edit lesson
            function editLesson(id) {
                const lesson = lessons.find(l => l.id === id);
                if (!lesson) return;
                
                subjectSelect.value = lesson.subject;
                weekSelect.value = lesson.week;
                daySelect.value = lesson.day;
                populateTopics(); // Repopulate topics
                if (document.getElementById('topic').tagName === 'SELECT') {
                    topicSelect.value = lesson.topic;
                } else {
                    document.getElementById('topic').value = lesson.topic;
                }
                document.getElementById('status').value = lesson.status;
                document.getElementById('notes').value = lesson.notes || '';
                
                editIdField.value = id;
                submitBtn.innerHTML = '<i class="fas fa-save"></i> Update';
                cancelEditBtn.style.display = 'inline-flex';
                
                lessonForm.scrollIntoView({ behavior: 'smooth' });
            }
            
            // Cancel edit
            function cancelEdit() {
                editIdField.value = '';
                lessonForm.reset();
                submitBtn.innerHTML = '<i class="fas fa-plus"></i> Add Lesson';
                cancelEditBtn.style.display = 'none';
                // Reset topic to select
                document.getElementById('topic-group').innerHTML = `
                    <label for="topic">Topic (MATATAG Curriculum)</label>
                    <select class="form-control" id="topic" required>
                        <option value="">Select Topic</option>
                    </select>
                `;
            }
            
            // Delete lesson
            function deleteLesson(id) {
                lessons = lessons.filter(lesson => lesson.id !== id);
                saveData();
                renderTable();
            }
            
            // Show confirmation
            function showConfirmation(message, callback) {
                confirmationMessage.textContent = message;
                pendingAction = callback;
                confirmationModal.style.display = 'flex';
            }
            
            // Form submission
            lessonForm.addEventListener('submit', function(e) {
                e.preventDefault();
                
                const subject = subjectSelect.value;
                const week = weekSelect.value;
                const day = daySelect.value;
                const topicElement = document.getElementById('topic');
                const topic = topicElement.value;
                const status = document.getElementById('status').value;
                const notes = document.getElementById('notes').value;
                const editId = editIdField.value;
                
                if (!editId) {
                    const isDuplicate = lessons.some(l => l.subject === subject && l.week === week && l.day === day && l.topic === topic);
                    if (isDuplicate) {
                        showError('Duplicate lesson!');
                        return;
                    }
                }
                
                const lessonData = {
                    subject,
                    week,
                    day,
                    topic,
                    status,
                    notes,
                    createdAt: new Date().toISOString()
                };
                
                if (editId) {
                    const index = lessons.findIndex(l => l.id === editId);
                    if (index !== -1) {
                        lessons[index] = { ...lessons[index], ...lessonData };
                    }
                } else {
                    lessonData.id = Date.now().toString();
                    lessons.push(lessonData);
                }
                
                saveData();
                renderTable();
                cancelEdit();
            });
            
            // Print
            printBtn.addEventListener('click', () => window.print());
            
            // PDF Export
            pdfBtn.addEventListener('click', function() {
                const doc = new jsPDF();
                doc.setFontSize(20);
                doc.text('Lesson Tracker 2030', 14, 15);
                doc.setFontSize(12);
                doc.setTextColor(100);
                
                let filtersText = 'All Lessons';
                if (currentFilters.subject !== 'all' || currentFilters.week !== 'all' || currentFilters.status !== 'all' || currentFilters.search) {
                    filtersText = 'Filtered Lessons' + (currentFilters.subject !== 'all' ? ` | Subject: ${filterSubject.options[filterSubject.selectedIndex].text}` : '') +
                                  (currentFilters.week !== 'all' ? ` | Week: ${currentFilters.week}` : '') +
                                  (currentFilters.status !== 'all' ? ` | Status: ${currentFilters.status}` : '') +
                                  (currentFilters.search ? ` | Search: ${currentFilters.search}` : '');
                }
                doc.text(filtersText, 14, 22);
                
                let filteredLessons = lessons.filter(lesson => {
                    if (currentFilters.subject !== 'all' && lesson.subject !== currentFilters.subject) return false;
                    if (currentFilters.week !== 'all' && lesson.week !== currentFilters.week) return false;
                    if (currentFilters.status !== 'all' && lesson.status !== currentFilters.status) return false;
                    if (currentFilters.search && !lesson.topic.toLowerCase().includes(currentFilters.search.toLowerCase())) return false;
                    return true;
                });
                
                const tableColumn = ["Subject", "Week", "Day", "Topic", "Status"];
                const tableRows = [];
                const subjectMap = {
                    'english': 'English',
                    'math': 'Mathematics',
                    'science': 'Science',
                    'filipino': 'Filipino',
                    'ap': 'Araling Panlipunan',
                    'epp': 'EPP',
                    'gmrc': 'GMRC',
                    'mapeh': 'MAPEH'
                };
                
                filteredLessons.forEach(lesson => {
                    tableRows.push([
                        subjectMap[lesson.subject],
                        `Week ${lesson.week}`,
                        `Day ${lesson.day}`,
                        lesson.topic,
                        lesson.status.charAt(0).toUpperCase() + lesson.status.slice(1)
                    ]);
                });
                
                doc.autoTable({
                    head: [tableColumn],
                    body: tableRows,
                    startY: 30,
                    theme: 'grid',
                    styles: { fontSize: 10, cellPadding: 3 },
                    headStyles: { fillColor: [0, 255, 255], textColor: 0, fontStyle: 'bold' },
                    alternateRowStyles: { fillColor: [240, 240, 240] }
                });
                
                const date = new Date();
                doc.save(`lessons-${date.toISOString().slice(0,10)}.pdf`);
            });
            
            // Reset
            resetBtn.addEventListener('click', () => showConfirmation('Clear all data?', () => {
                lessons = [];
                saveData();
                renderTable();
                cancelEdit();
            }));
            
            // Filters
            applyFilters.addEventListener('click', () => {
                currentFilters.subject = filterSubject.value;
                currentFilters.week = filterWeek.value;
                currentFilters.status = filterStatus.value;
                currentFilters.search = searchInput.value;
                renderTable();
            });
            
            clearFilters.addEventListener('click', () => {
                filterSubject.value = 'all';
                filterWeek.value = 'all';
                filterStatus.value = 'all';
                searchInput.value = '';
                currentFilters = { subject: 'all', week: 'all', status: 'all', search: '' };
                renderTable();
            });
            
            // Cancel edit
            cancelEditBtn.addEventListener('click', cancelEdit);
            
            // Export JSON
            exportJsonBtn.addEventListener('click', () => {
                const dataStr = JSON.stringify(lessons, null, 2);
                const dataUri = 'data:application/json;charset=utf-8,' + encodeURIComponent(dataStr);
                const link = document.createElement('a');
                link.href = dataUri;
                link.download = `lessons-${new Date().toISOString().slice(0,10)}.json`;
                link.click();
            });
            
            // Import JSON
            importJsonBtn.addEventListener('click', () => importFileInput.click());
            importFileInput.addEventListener('change', (event) => {
                const file = event.target.files[0];
                if (!file) return;
                const reader = new FileReader();
                reader.onload = (e) => {
                    try {
                        const imported = JSON.parse(e.target.result);
                        if (!Array.isArray(imported)) throw new Error('Invalid data');
                        showConfirmation(`Import ${imported.length} lessons? Replaces current.`, () => {
                            lessons = imported.map(l => ({ ...l, id: l.id || Date.now().toString() }));
                            saveData();
                            renderTable();
                            importFileInput.value = '';
                        });
                    } catch (err) {
                        showError('Import failed. Invalid file.');
                        importFileInput.value = '';
                    }
                };
                reader.readAsText(file);
            });
            
            // Modal handlers
            confirmActionBtn.addEventListener('click', () => {
                if (pendingAction) pendingAction();
                confirmationModal.style.display = 'none';
                pendingAction = null;
            });
            cancelActionBtn.addEventListener('click', () => {
                confirmationModal.style.display = 'none';
                pendingAction = null;
            });
            modalCloseBtn.addEventListener('click', () => {
                confirmationModal.style.display = 'none';
                pendingAction = null;
            });
            window.addEventListener('click', (event) => {
                if (event.target === confirmationModal) {
                    confirmationModal.style.display = 'none';
                    pendingAction = null;
                }
            });
            
            // Init
            loadData();
        });
    </script>
</body>
</html>
